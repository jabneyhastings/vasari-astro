---
import Layout from '../layouts/Layout.astro';
import HeroImage from '../components/HeroImage.astro';
import { getCollection, getEntry, render } from 'astro:content';

export async function getStaticPaths() {
  const entries = await getCollection('pages');
  // Remove .md extension from entry.id if present
  return entries.map(entry => {
    let id = entry.id;
    if (id.endsWith('.md')) id = id.slice(0, -3);
    return { params: { page: id } };
  });
}

const { page } = Astro.params;
let entry = await getEntry('pages', page);

if (!entry) {
  // Try with .md fallback for older Astro versions
  entry = await getEntry('pages', `${page}.md`);
}
if (!entry) {
  throw new Error(`Page not found: ${page}`);
}

const { Content } = await render(entry);
const { title, description, heroImage } = entry.data;
---
<Layout title={title} description={description}>
  {heroImage && <HeroImage src={heroImage} alt={title} />}
  <section class="page-content" transition:name="page-content">
    <h1>{title}</h1>
    <Content />
  </section>
</Layout>

<style>

</style>
